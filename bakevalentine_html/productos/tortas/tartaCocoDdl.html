<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="torta.css" />
    <title>Tarta de coco y dulce de leche</title>
</head>
<body>
    <button class="atras" onclick="location.href='../tortas/tortas.html'">
        <i class="fa-solid fa-arrow-left"></i>
    </button>

    <div class="producto">
        <h2 class="Nombre-producto">Tarta de coco y dulce de leche</h2>
        <div class="tiempo">
            <i class="fa-solid fa-clock"></i>
            <p class="Tiempo-entrega"> Tiempo de entrega: 3 a 4 días </p>
        </div>
        <div class="descripcion"></div>

        <!-- Tamaño / cantidad por paquete -->
        <div class="opciones">
            <label id="Tamano-text" for="tamano">Tamaño</label>
            <div class="custom-select" id="tamano">
                <div class="select-btn">Porción</div>
                <div class="options">
                    <div data-value="porcion" data-precio="6000">Individual 10cm</div>
                    <div data-value="chica" data-precio="7000">Chica 12cm</div>
                    <div data-value="mediana" data-precio="14000">Mediana 18cm</div>
                    <div data-value="grande" data-precio="20000">Grande 18cm</div>
                </div>
            </div>
        </div> <!-- cierre de .opciones -->

        <div class="precio-cantidad">
            <div class="precio"> Total
                <p class="texto-precio">$2500</p>
            </div>
            <div class="cantidad">
                <button class="menos"><i class="fa-solid fa-minus"></i></button>
                <span class="cantidad-numero">1</span>
                <button class="mas"><i class="fa-solid fa-plus"></i></button>
            </div>
        </div>

        <div class="carrito">
            <button class="agregar-carrito">Agregar <i class="fa-solid fa-cart-shopping"></i></button>
        </div>

        <script>
            let cantidad = 1;

            // Elementos
            const cantidadSpan = document.querySelector('.cantidad-numero');
            const totalSpan = document.querySelector('.texto-precio');
            const botonMas = document.querySelector('.mas');
            const botonMenos = document.querySelector('.menos');
            const btnAgregar = document.querySelector('.agregar-carrito');

            const nombreProducto = "Tarta de coco y dulce de leche";

            // Dropdown Tamaño
            const tamanoSelect = document.getElementById('tamano');
            const btnTamano = tamanoSelect.querySelector('.select-btn');
            const optionsTamano = tamanoSelect.querySelector('.options');

            // Inicializar precio y valor por defecto
            btnTamano.dataset.precio = 2500;
            btnTamano.dataset.value = 'porcion';

            // Función para actualizar total
            function actualizarTotal() {
                const precioTamano = parseInt(btnTamano.dataset.precio || 0);
                const total = precioTamano * cantidad;
                cantidadSpan.textContent = cantidad;
                totalSpan.textContent = `$${total}`;
            }

            // Botones + y -
            botonMas.addEventListener('click', () => { cantidad++; actualizarTotal(); });
            botonMenos.addEventListener('click', () => { if (cantidad > 1) { cantidad--; actualizarTotal(); } });

            // Dropdown Tamaño
            btnTamano.addEventListener('click', () => {
                optionsTamano.style.display = optionsTamano.style.display === 'block' ? 'none' : 'block';
            });
            optionsTamano.querySelectorAll('div').forEach(option => {
                option.addEventListener('click', () => {
                    btnTamano.textContent = option.textContent;
                    btnTamano.dataset.value = option.dataset.value;
                    btnTamano.dataset.precio = option.dataset.precio;
                    optionsTamano.style.display = 'none';
                    actualizarTotal();
                });
            });

            // Cerrar dropdowns al hacer clic fuera
            document.addEventListener('click', (e) => {
                if (!tamanoSelect.contains(e.target)) optionsTamano.style.display = 'none';
            });

            // Agregar al carrito
            btnAgregar.addEventListener('click', () => {
                const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
                const tamano = btnTamano.dataset.value;
                const precioUnitario = parseInt(btnTamano.dataset.precio);
                const totalProducto = precioUnitario * cantidad;

                const index = carrito.findIndex(item => item.nombre === nombreProducto && item.tamano === tamano);

                if (index > -1) {
                    carrito[index].cantidad += cantidad;
                    carrito[index].total = carrito[index].cantidad * precioUnitario;
                } else {
                    carrito.push({ nombre: nombreProducto, tamano, cantidad, precioUnitario, total: totalProducto });
                }

                localStorage.setItem('carrito', JSON.stringify(carrito));
                alert("Producto agregado al carrito!");
            });

            // Inicializar total
            actualizarTotal();
        </script>
    </div>
</body>
</html>
