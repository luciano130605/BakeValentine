<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="pepas.css" />
    <title>Pepa de dulce de leche</title>
</head>

<body>
    <button class="atras" onclick="location.href='../pepas-y-scones/pepas-y-scones.html'"><i
            class="fa-solid fa-arrow-left"></i></button>

    <div class="producto">
        <h2 class="Nombre-producto">Pepa de dulce de leche</h2>
        <div class="tiempo">
            <i class="fa-solid fa-clock"></i>
            <p class="Tiempo-entrega"> Tiempo de entrega: 2 a 3 días </p>
        </div>
        <div class="descripcion"> Descripción
            <p class="texto-descripcion"> </p>
        </div>

        <!-- Tipo de masa -->
        <div class="opciones">
            <label id="Masa-text" for="masa">Masa:</label>
            <div class="custom-select" id="masa">
                <div class="select-btn">Seleccioná masa</div>
                <div class="options">
                    <div data-value="vainilla" data-precio="0">Vainilla</div>
                    <div data-value="chocolate" data-precio="0">Chocolate</div>
                </div>
            </div>
        </div>

        <!-- Tamaño / cantidad por paquete -->
        <div class="opciones">
            <label id="Tamano-text" for="tamano">Cantidad:</label>
            <div class="custom-select" id="tamano">
                <div class="select-btn">Seleccioná cantidad</div>
                <div class="options">
                    <div data-value="media" data-precio="3000">Media docena (6)</div>
                    <div data-value="docena" data-precio="5000">Docena (12)</div>
                </div>
            </div>
        </div>
        <div class="precio-cantidad">
            <div class="precio"> Total
                <p class="texto-precio">$3000</p>
            </div>
            <div class="cantidad">
                <button class="menos"><i class="fa-solid fa-minus"></i></button>
                <span class="cantidad-numero">1</span>
                <button class="mas"><i class="fa-solid fa-plus"></i></button>
            </div>
        </div>

        <div class="carrito">
            <button class="agregar-carrito">Agregar <i class="fa-solid fa-cart-shopping"></i></button>
        </div>

        <script>
            let cantidad = 1;

            // Elementos
            const cantidadSpan = document.querySelector('.cantidad-numero');
            const totalSpan = document.querySelector('.texto-precio');
            const botonMas = document.querySelector('.mas');
            const botonMenos = document.querySelector('.menos');
            const btnAgregar = document.querySelector('.agregar-carrito');

            const nombreProducto = "Pepa de dulce de leche";

            // Dropdowns custom
            const masaSelect = document.getElementById('masa');
            const tamanoSelect = document.getElementById('tamano');
            const btnMasa = masaSelect.querySelector('.select-btn');
            const optionsMasa = masaSelect.querySelector('.options');
            const btnTamano = tamanoSelect.querySelector('.select-btn');
            const optionsTamano = tamanoSelect.querySelector('.options');

            // Inicializar precios
            btnMasa.dataset.precio = 0;
            btnTamano.dataset.precio = 3000;

            // Función para actualizar total
            function actualizarTotal() {
                const precioMasa = parseInt(btnMasa.dataset.precio || 0);
                const precioTamano = parseInt(btnTamano.dataset.precio || 0);
                const total = (precioMasa + precioTamano) * cantidad;
                cantidadSpan.textContent = cantidad;
                totalSpan.textContent = `$${total}`;
            }

            // Botones + y -
            botonMas.addEventListener('click', () => { cantidad++; actualizarTotal(); });
            botonMenos.addEventListener('click', () => { if (cantidad > 1) { cantidad--; actualizarTotal(); } });

            // Dropdown Masa
            btnMasa.addEventListener('click', () => {
                optionsMasa.style.display = optionsMasa.style.display === 'block' ? 'none' : 'block';
            });
            optionsMasa.querySelectorAll('div').forEach(option => {
                option.addEventListener('click', () => {
                    btnMasa.textContent = option.textContent;
                    btnMasa.dataset.value = option.dataset.value;
                    btnMasa.dataset.precio = option.dataset.precio;
                    optionsMasa.style.display = 'none';
                    actualizarTotal();
                });
            });

            // Dropdown Tamaño
            btnTamano.addEventListener('click', () => {
                optionsTamano.style.display = optionsTamano.style.display === 'block' ? 'none' : 'block';
            });
            optionsTamano.querySelectorAll('div').forEach(option => {
                option.addEventListener('click', () => {
                    btnTamano.textContent = option.textContent;
                    btnTamano.dataset.value = option.dataset.value;
                    btnTamano.dataset.precio = option.dataset.precio;
                    optionsTamano.style.display = 'none';
                    actualizarTotal();
                });
            });

            // Cerrar dropdowns al hacer clic fuera
            document.addEventListener('click', (e) => {
                if (!masaSelect.contains(e.target)) optionsMasa.style.display = 'none';
                if (!tamanoSelect.contains(e.target)) optionsTamano.style.display = 'none';
            });

            // Agregar al carrito
            btnAgregar.addEventListener('click', () => {
                const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
                const masa = btnMasa.dataset.value;
                const tamano = btnTamano.dataset.value;
                const precioUnitario = parseInt(btnMasa.dataset.precio) + parseInt(btnTamano.dataset.precio);
                const totalProducto = precioUnitario * cantidad;

                // Buscar si existe el mismo producto con las mismas opciones
                const index = carrito.findIndex(item => item.nombre === nombreProducto && item.masa === masa && item.tamano === tamano);

                if (index > -1) {
                    carrito[index].cantidad += cantidad;
                    carrito[index].total = carrito[index].cantidad * precioUnitario;
                } else {
                    carrito.push({ nombre: nombreProducto, masa, tamano, cantidad, precioUnitario, total: totalProducto });
                }

                localStorage.setItem('carrito', JSON.stringify(carrito));
                alert("Producto agregado al carrito!");
            });

            // Inicializar total
            actualizarTotal();
        </script>

    </div>
</body>

</html>